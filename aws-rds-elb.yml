---
name: demo
datacenter: aws-de

vpc_subnet: 10.0.0.0/16

networks:
  - name: dmz1
    subnet: 10.0.11.0/24
    availability_zone: eu-central-1a
    public: true
  - name: web1
    subnet: 10.0.12.0/24
    availability_zone: eu-central-1a
    public: false
    nat_gateway: nat1
  - name: dmz2
    subnet: 10.0.13.0/24
    availability_zone: eu-central-1b
    public: true
  - name: web2
    subnet: 10.0.14.0/24
    availability_zone: eu-central-1b
    public: false
    nat_gateway: nat2

nat_gateways:
  - name: nat1
    public_network: dmz1
  - name: nat2
    public_network: dmz2

security_groups:
  - name: sg-vm
    egress:
      - ip: 0.0.0.0/0
        protocol: any
        from_port: '0'
        to_port: '65535'
    ingress:
      - ip: 10.0.0.0/16
        protocol: tcp
        from_port: '0'
        to_port: '65535'
      - ip: 79.173.143.3/32
        protocol: tcp
        from_port: '0'
        to_port: '65535'
      - ip: 81.96.158.43/32
        protocol: tcp
        from_port: '0'
        to_port: '65535'
  - name: sg-rds
    egress:
      - ip: 10.0.0.0/16
        protocol: tcp
        from_port: '0'
        to_port: '65535'
    ingress:
      - ip: 10.0.0.0/16
        protocol: tcp
        from_port: '0'
        to_port: '65535'

instances:
  - name: web1
    type: t2.micro
    image: ami-8504fdea
    network: web1
    start_ip: 10.0.12.11
    count: 1
    key_pair: jason-work
    user_data: '@{aws-rds-elb-data.yml}'
    security_groups:
      - sg-vm

route53_zones:
  - name: r3dev.io
    private: false
    records:
      - entry: mysql.r3dev.io
        type: CNAME
        ttl: 3600
        rds_instances:
          - mysql1
      - entry: web1.r3dev.io
        type: A
        ttl: 3600
        instances:
          - web1-1

rds_instances:
  - name: mysql1
    size: db.t2.micro
    public: false
#    availability_zone: eu-central-1a
    networks: 
      - web1
      - web2
    port: 3306
    license: general-public-license
    security_groups:
      - sg-rds
    engine: mysql
    storage:
      type: gp2
      size: 20
    database_name: mysqltest5
    database_username: mysqltest5
    database_password: mysqltest5
    